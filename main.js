(()=>{"use strict";var A={128:A=>{A.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAJACAYAAAA6rgFWAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAC6hJREFUeJzt1zEBwCAAwDBADiaRDi62o4mCvp373DsAAICE9XcAAADwHQMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDkAcX1Byd62dWAAAAAAElFTkSuQmCC"},357:A=>{A.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAJACAYAAAA6rgFWAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAC6VJREFUeJzt1zEBACAMwLCBf8/gAo4mCvp2zcwZAAAgYf8OAAAA3jEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCDAAAAIQYAAAACDEAAAAQYgAAACDEAAAAQIgBAACAEAMAAAAhBgAAAEIMAAAAhBgAAAAIMQAAABBiAAAAIMQAAABAiAEAAIAQAwAAACEGAAAAQgwAAACEGAAAAAgxAAAAEGIAAAAgxAAAAECIAQAAgBADAAAAIQYAAABCLnD4BX8jLVaAAAAAAElFTkSuQmCC"}},t={};function e(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return A[i](n,n.exports,e),n.exports}(()=>{class A{}class t{static inject(A,e){return t.container.has(A)||i(A.name),s(A,e)}static provide(A){A.forEach((A=>{if(A instanceof Function)return void o(A,A,!1);if("useValue"in A){const t=()=>A.useValue;class e{constructor(){return t()}}return void o(A.provide,e,!1)}const{provide:t,useClass:e}=A;o(t,e,A.injectMultiples)}))}}t.container=new Map;const i=A=>{throw new Error(`No provider for token: ${A}\n                Tip: declare it in providers array, like this: \n                const providers = [ /* ...other providers */, ${A}];\n                provide(prodivers)\n\n                Or like this, if ${A} is an injection token:\n                const providers = [ /* ...other providers */, {token:${A}, useClass: Implementation}];\n                provide(prodivers)\n                `)},s=(A,e)=>{const i=t.container.get(A),s=Boolean(i?.injectMultiples);return n(i.Class,e),s?new i.Class(e):(i.instance||(i.instance=new i.Class(e)),i.instance)},n=(A,t)=>{if(A.length&&!t)throw new Error(`Class ${A.name} was injected without props`)},o=(A,e,i)=>{t.container.set(A,{Class:e,injectMultiples:i})},{inject:g,provide:a}=t;class r{constructor(A,t){this._subscriberCallback=A,this._unsubscribeCallback=t}subscribe(A){return this._subscriberCallback(A),{unsubscribe:()=>{this._unsubscribeCallback?.(A)}}}map(A){let t;return new r((e=>{t={next(t){e.next(A(t))},error(A){e.error?.(A)}},this.subscribe(t)}),(()=>this._unsubscribeCallback?.(t)))}filter(A){let t;return new r((e=>{t={next(t){A(t)&&e.next(t)},error(A){e.error?.(A)}},this.subscribe(t)}),(()=>{this._unsubscribeCallback?.(t)}))}tap(A){return this.map((t=>(A(t),t)))}concatMap(A){let t;return new r((e=>{t={next(t){A(t).subscribe(e)},error(A){e.error?.(A)}},this.subscribe(t)}),this._unsubscribeCallback)}}class h{constructor(){this._subscribers=[],this.toObservable=()=>new r((A=>{this._subscribers.push(A)}),(A=>{this._subscribers=this._subscribers.filter((t=>t!=A))}))}next(A){this.value=A,this._subscribers.forEach((t=>{t.next(A)}))}}class c extends h{constructor(A){super(),this._initialValue=A,this.value=this._initialValue,this.next(this.value)}}const I=(...A)=>new r((({next:t})=>{A.forEach(t)}));class E{constructor(){this._shouldStopAnimation=!1,this._consistentBaseFrameRate=60;const A=this._getRecursiveCallback();this._smoothFramePass$=new r((({next:t})=>{A(t)}),(()=>{this._shouldStopAnimation=!0})),this.setConsistentCallback()}_getRecursiveCallback(){const A=t=>{t(!0),this._shouldStopAnimation||requestAnimationFrame((()=>{A(t)}))};return A}setConsistentCallback(){const A=new c(0);this._consistentFramePass$=A.toObservable();const t=Math.round(1e3/this._consistentBaseFrameRate);setInterval((()=>{A.next(A.value+1)}),t)}checkFramePass(A){return A?this._getAdjustedFrameEmitter(A)?.map(Boolean):this._smoothFramePass$}_getAdjustedFrameEmitter(A){const t=Math.round(this._consistentBaseFrameRate/A);return this._consistentFramePass$?.filter((A=>A%t==0))}}class Q{constructor(){this._keydown$=new h,this._keyup$=new h,this._nextFrameService=g(E),this.listenKeyPress=A=>this._keypress$.filter((t=>t===A)),this.listenKeyUp=A=>this._keyup$.toObservable().filter((t=>t===A)).map(Boolean),addEventListener("keydown",(A=>{this._keydown$.next(this.threatKeys(A.key))})),addEventListener("keyup",(A=>{this._keyup$.next(this.threatKeys(A.key))}))}get _keypress$(){const A=new Map;return this._keydown$.toObservable().subscribe({next:t=>{A.set(t,!0)}}),this._keyup$.toObservable().subscribe({next:t=>{A.delete(t)}}),this._nextFrameService.checkFramePass(60).concatMap((()=>I(...A.keys())))}threatKeys(A){return" "===A?"space":A.toLocaleLowerCase()}}class B{constructor(){this._action$=new h,this.action$=this._action$.toObservable()}get currentState(){return this._state}setState(A,t){this._state?.clearSubscriptions(),this._state=A,this._state.onInit(t)}executeRoutine(A){this._state.execute(A)}emit(A,t){this._action$.next({action:A,data:t})}getCurrentStateName(){return this._state?.name}}class C{constructor(A){this.stateMachine=A,this._subscriptions=[],this.on=(A,t)=>{const e=this._filterEmittedActions(A).subscribe({next:({data:A})=>{t(A)}});this._subscriptions.push(e)},this.setTransition=A=>{this._filterEmittedActions(A.on).subscribe({next:({data:t})=>{this.stateMachine.getCurrentStateName()===A.from&&this.stateMachine.setState(this,{...A.do?.(this.stateMachine.currentState),...t})}})}}clearSubscriptions(){this._subscriptions.forEach((A=>{A.unsubscribe()}))}_filterEmittedActions(A){return this.stateMachine.action$.filter((t=>t.action===A))}}class l extends C{constructor(A){super(A.stateMachine),this.name="standing"}onInit(){}listenActions(){}execute(A){}}const M={friction:.15,maxVelocity:1e3,initialAcceleration:0};class u extends C{constructor(A){super(A.stateMachine),this.name="moving",this.velocity=0,this.onInit=()=>{this.velocity=0,this.acceleration=this._props.initialAcceleration,this.on("goLeft",(()=>{this.accelerate(-1)})),this.on("goRight",(()=>{this.accelerate(1)}))},this.execute=(A,t=!1)=>{t&&this.accelerate(),this._applyFriction(),this._limitVelocity(),this._moveView(A)},this.accelerate=A=>{this.velocity+=A?A*Math.abs(this.acceleration):this.acceleration},this._moveView=A=>{A.position[this._props.axis]+=this.velocity},this._props={...M,...A},this._validateMaxVelocity(),this.acceleration=this._props.initialAcceleration}listenActions(){this.setTransition({from:"standing",on:"goLeft"}),this.setTransition({from:"standing",on:"goRight"}),this.setTransition({from:"jumping",on:"endJump",do:A=>{this.velocity=A.movingX.velocity}})}_limitVelocity(){if(Math.abs(this.velocity)>this._props.maxVelocity){const A=Math.sign(this.velocity);this.velocity=A*this._props.maxVelocity}}_applyFriction(){this.velocity*=1-this._props.friction}_validateMaxVelocity(){if(this._props.maxVelocity<0)throw new Error("Max velocity must be greater or equal to 0")}}class x{constructor(){this.nextFrameService=g(E),this._mouseMove$=new h,addEventListener("mousemove",(A=>{const t={x:A.clientX,y:A.clientY};this._mouseMove$.next((A=>({x:A.x,y:window.innerHeight-A.y}))(t))}))}observeMouseMove(){return this._mouseMove$.toObservable()}}class m extends C{constructor(A){super(A.stateMachine),this._props=A,this.name="controlling",this._armLength=this._props.arm.box.height;const t={stateMachine:this._props.stateMachine,axis:"angle"};this._movingFullArm=g(u,t),this._movingForeArm=g(u,t)}listenActions(){this.setTransition({from:"falling",on:"control",do:A=>{A.stop()}})}onInit(){this.on("control",(A=>{this._mousePosition=A?.mousePosition,this._foreArmAngle=this._calculateForeArmAngle(this._props.arm),this._armAngle=this._calculateArmAngle(this._props.arm,this._foreArmAngle)}))}execute(A){const t=this._props.arm.position.angle,e=this._props.arm.components.forearm.position.angle;this._movingFullArm.velocity=this.getControlVelocity(t,this._armAngle)||0,this._movingFullArm.execute(A),this._movingForeArm.velocity=this.getControlVelocity(e,this._foreArmAngle)||0,this._movingForeArm.execute(A.components.forearm,!0)}getControlVelocity(A,t){return.2*-Math.sin(A-t)}_calculateForeArmAngle(A){if(!A.position.absolute||!this._mousePosition)return;let t=((A,t)=>{const e=A.x-t.x,i=A.y-t.y;return Math.sqrt(e**2+i**2)})(this._mousePosition,A.position.absolute);return t>=this._armLength&&(t=this._armLength),2*Math.acos(-t/this._armLength)}_calculateArmAngle(A,t){const e=(s=A.position.absolute,{x:(i=this._mousePosition).x-s.x,y:i.y-s.y});var i,s;e.x=e.x||.01,e.y=e.y||.01;const n=Math.PI+Math.atan(e.x/e.y)-t/2,o=-Math.PI/2-Math.atan(e.y/e.x)-t/2,g=+Math.atan(e.x/e.y)-t/2;return e.y>0?n:e.x>0?o:g}}const p={armMass:1,friction:.07};class D extends C{constructor(A){super(A.stateMachine),this.name="falling",this._props={...p,...A};const t={axis:"angle",initialAcceleration:0,friction:this._props.friction,stateMachine:this._props.stateMachine};this._movingFullArm=g(u,t),this._movingForeArm=g(u,t)}listenActions(){this.setTransition({from:"controlling",on:"loose"})}onInit(){}execute(A){console.log(this._props.friction),this.acceleratePendulums(A),this._movingFullArm.execute(A,!0),this._movingForeArm.execute(A.components.forearm,!0)}stop(){this._movingForeArm.velocity=0,this._movingFullArm.velocity=0}acceleratePendulums(A){const t={length:this._props.armLength/2,mass:this._props.armMass},e=((A,t,e)=>{const i=A.mass,s=t.mass,n=A.length,o=t.length,g=Math.PI-A.angle,a=-t.angle,r=A.velocity,h=t.velocity;return{pendulum1Acceleration:-(-1*(2*i+s)*Math.sin(g)+1*-s*Math.sin(g-2*a)+-2*Math.sin(g-a)*s*(h**2*o+r**2*n*Math.cos(g-a)))/(n*(2*i+s-s*Math.cos(2*g-2*a))),pendulum2Acceleration:-2*Math.sin(g-a)*(r**2*n*(i+s)+1*(i+s)*Math.cos(g)+h**2*o*s*Math.cos(g-a))/(o*(2*s+s-s*Math.cos(2*g-2*a)))}})({...t,angle:A.position.angle,velocity:this._movingFullArm.velocity},{...t,angle:A.components.forearm.position.angle,velocity:this._movingForeArm.velocity});this._movingFullArm.acceleration=e.pendulum1Acceleration,this._movingForeArm.acceleration=e.pendulum2Acceleration}}const w={initialVelocity:30};class _ extends C{constructor(A){super(A.stateMachine),this._props=A,this.name="jumping",this._props={...this._props,...w},this.movingX=g(u,{stateMachine:A.stateMachine,axis:"x",initialAcceleration:1}),this.movingY=g(u,{stateMachine:this._props.stateMachine,axis:"y",initialAcceleration:-1.6,friction:.001})}listenActions(){this.setTransition({on:"jump",from:"moving",do:A=>{this.movingX.velocity=A.velocity}})}onInit(A){this.movingY.velocity=this._props.initialVelocity??0,this.on("goLeft",(()=>{this.movingX.accelerate(-1)})),this.on("goRight",(()=>{this.movingX.accelerate(1)}))}execute(A){this.movingX.execute(A),this.movingY.accelerate(),this.movingY.execute(A),A.position.absolute&&A.position.absolute?.y<0&&(A.position.y=0,A.position.absolute.y=0,this._props.stateMachine.emit("endJump"))}}const G=[{name:"box",load:e(357)},{name:"blue-box",load:e(128)}],Y=document.createElement("canvas");document.body.appendChild(Y);const b=Y.getContext("2d"),v=()=>{Y.width=innerWidth,Y.height=innerHeight};v(),addEventListener("resize",v);class d{constructor(){this.graphics=b,this.imageLoader=this._getImageLoader()}_getImageLoader(){const A=G.map((({name:A,load:t})=>{const e=new Image;return e.src=t,[A,{image:e}]}));return new Map(A)}}class y{constructor(){this._api=g(A)}drawCanvas(A){this._clearCanvas(),this._drawComponentTree(A)}_drawComponentTree(A){Object.values(A).forEach((A=>{const t=((A,t,e)=>({x:A.x-t.width/2,y:e.canvas.height-A.y-t.height,angle:A.angle}))(A.position.absolute??A.position,A.box,this._api.graphics);A.sprite&&this._showImage(A.sprite,A.box,t),A.components&&this._drawComponentTree(A.components)}))}_showImage(A,t,e){const i=this._api.graphics;i.save();const s={x:e.x+t.width/2,y:e.y+t.height};i.translate(s.x,s.y),i.rotate(e.angle),s.x=-t.width/2,s.y=-t.height,i.drawImage(A,s.x,s.y,t.width,t.height),i.restore()}_flipFigure(A,t,e){A.x=-A.x-t,e.scale(-1,1)}_clearCanvas(){const{width:A,height:t}=this._api.graphics.canvas;this._api.graphics.clearRect(0,0,A,t)}}const f=[B,l,u,D,m,_].map((A=>({provide:A,useClass:A,injectMultiples:!0})));class F{constructor(A){const{x:t,y:e}=A.position,{width:i,height:s}=A.box;this._setCoordinates({x:t,y:e},i,s)}_setCoordinates(A,t,e){this.position={bottomLeft:{x:A.x-t/2,y:A.y},topLeft:{x:A.x-t/2,y:A.y+e},bottomRight:{x:A.x+t/2,y:A.y},topRight:{x:A.x+t/2,y:A.y+e}}}checkIntercectionWith(A){for(let t of Object.values(A.position))if(this.contains(t))return!0;return!1}contains(A){const{bottomLeft:t,topRight:e}=this.position;return this._isValueInInterval(A.x,t.x,e.x)&&this._isValueInInterval(A.y,t.y,e.y)}_isValueInInterval(A,t,e){return A>=t&&A<=e}}a([class{constructor(){this._fightersMap=new Map}registerFighter(A){const t=new c({life:100});this._fightersMap.set(A,t)}watchStatusChange(A){return this._fightersMap.get(A)?.toObservable()}getFighterStatus(A){return this._fightersMap.get(A)?.value}dealDamageInFighter(A,t){const e=this._fightersMap.get(A);if(!e)return;const i=e.value.life-t;e.next({life:i})}observeFighterDeath(A){return this.watchStatusChange(A)?.filter((A=>0===A.life))}},Q,x,E,class{constructor(){this._nextFrameService=g(E),this._observers=[]}observeCollision(A){return this._observers.push(A),this._nextFrameService.checkFramePass().concatMap((()=>I(...this.getColliders(A))))}getColliders(A){const t=[];return this._observers.forEach((e=>{A!=e&&this.checkCollision(A,e)&&t.push(e)})),t}checkCollision(A,t){const e=new F(A),i=new F(t);return e.checkIntercectionWith(i)}},y,{provide:A,useClass:d},d]),a(f);const k=(()=>{const A=g(d),t={box:{height:150,width:50},position:{x:0,y:125,angle:Math.PI/6},components:{arm:{sprite:A.imageLoader.get("blue-box").image,box:{height:75,width:25},position:{x:0,y:0,angle:0}},forearm:{sprite:A.imageLoader.get("blue-box").image,box:{height:75,width:25},position:{x:0,y:75,angle:Math.PI/6}}}};return{player:{sprite:A.imageLoader.get("box").image,box:{height:250,width:50},position:{x:200,y:0,angle:0},components:{fullArm:t}},enemy:{sprite:A.imageLoader.get("box").image,box:{height:100,width:30},position:{x:500,y:0,angle:0}}}})();(A=>{let t,e,i=g(x),s={x:0,y:0};!function(){t=g(B),A.stateMachine=t;const s=g(l,{stateMachine:t});s.listenActions(),t.setState(s),g(u,{stateMachine:t,initialAcceleration:1,axis:"x"}).listenActions(),g(_,{stateMachine:t}).listenActions(),e=g(Q),i=g(x)}(),e.listenKeyPress("a").subscribe({next:()=>{t.emit("goLeft")}}),e.listenKeyPress("d").subscribe({next:()=>{t.emit("goRight")}}),e.listenKeyPress("w").subscribe({next:()=>{t.emit("jump")}}),function(){const t=e.listenKeyPress("space").map((A=>s)),i=e.listenKeyUp("space");((A,t,e)=>{let i,s;!function(){const t=A.box.height;i=g(B),A.stateMachine=i;const e=g(D,{stateMachine:i,armLength:t});e.listenActions(),i.setState(e),g(m,{stateMachine:i,arm:A}).listenActions(),s=g(x)}(),t.subscribe({next:A=>{i.emit("control",{mousePosition:A})}}),e.subscribe({next:()=>{i.emit("loose")}})})(A.components.fullArm,t,i)}(),i.observeMouseMove().subscribe({next:A=>{s=A}})})(k.player);const L=g(E),P=g(y);function V(A,t){Object.values(A).forEach((A=>{((A,t={x:0,y:0,angle:0})=>{const e=(i=A.position,s=t.angle,{x:i.x*Math.cos(s)+i.y*Math.sin(s),y:i.y*Math.cos(s)-i.x*Math.sin(s)});var i,s;A.position.absolute={x:t.x+e.x,y:t.y+e.y,angle:A.position.angle+t.angle}})(A,t?.position.absolute),A.stateMachine?.executeRoutine(A),A.components&&V(A.components,A)}))}L.checkFramePass(60).subscribe({next:()=>{V(k)}}),L.checkFramePass().subscribe({next:()=>{P.drawCanvas(k)}})})()})();